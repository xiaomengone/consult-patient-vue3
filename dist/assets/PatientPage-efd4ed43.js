import{d as J,r as f,a as K,I as G,q as O,H as S,b as l,o as i,c as u,e as o,i as g,f as s,F as Q,s as W,w as _,g as $,h as X,j as Y,J as Z,v as ee,t as C,K as ae,p as te,m as oe,_ as ne}from"./index-917a8082.js";import{e as se,f as le,g as ie,h as ue}from"./user-e9a35a4c.js";import{C as de}from"./CpRadioBtn-6dace372.js";import{C as R}from"./CpNavBar-0433d01b.js";import{n as ce,i as re}from"./rules-7d7cfbfb.js";import{a as pe}from"./function-call-2c0d12ed.js";import{s as ve,a as _e}from"./function-call-abbe6575.js";import"./request-9f1dea72.js";const k=h=>(te("data-v-1d2edcc7"),h=h(),oe(),h),me={class:"patient-page"},fe={key:0,class:"patient-change"},ge=k(()=>s("h3",null,"请选择患者信息",-1)),he=k(()=>s("p",null,"以便医生给出更准确的治疗，信息仅医生可见",-1)),Ce=[ge,he],ke={class:"patient-list"},be=["onClick"],ye={class:"info"},we={class:"name"},Ve={class:"id"},Pe=["onClick"],xe={key:0,class:"tag"},Fe=k(()=>s("p",null,"添加患者",-1)),Be=k(()=>s("div",{class:"patient-tip"},"最多可添加 6 人",-1)),Ie={key:1,class:"patient-next"},Se=J({__name:"PatientPage",setup(h){const d=f(!1),b=K(),c=f(),L=[{label:"男",value:1},{label:"女",value:0}],P={name:"",idCard:"",gender:1,defaultFlag:0},a=f({...P}),x=f(),r=f(),N=G(),y=async()=>{var t;const n=await se();if(c.value=n==null?void 0:n.data,b.query.isChange&&((t=c.value)!=null&&t.length)){const p=c.value.find(m=>m.defaultFlag===1);p?r.value=p.id:r.value=c.value[0].id}},F=n=>{if(n){console.log("edit");const{id:t,name:p,idCard:m,gender:v,defaultFlag:V}=n;a.value={id:t,name:p,idCard:m,gender:v,defaultFlag:V}}else console.log("add"),a.value={...P};d.value=!0};O(()=>{y()});const B=S({get:()=>a.value.defaultFlag===1,set:n=>{a.value.defaultFlag=n?1:0}}),U=async()=>{await x.value.validate();const n=a.value.id?await le(a.value):await ie(a.value);console.log("1res",n),y(),d.value=!1,pe(a.value.id?"编辑成功":"添加成功")},q=async()=>{a.value.id&&(await ve({title:"温馨提示",message:`您确定删除 ${a.value.name} 患者信息吗？`}),await ue(a.value.id),d.value=!1,y())},w=S(()=>b.query.isChange==="1"?"选择患者":"家庭档案"),D=n=>{b.query.isChange&&(r.value=n.id)},z=async()=>{r.value?N.setPationtId(r.value):_e({title:"标题",message:"代码是写出来给人看的，附带能在机器上运行。"}),Z.push("/consult/pay")};return(n,t)=>{var I;const p=l("van-icon"),m=l("cp-icon"),v=l("van-field"),V=l("van-checkbox"),M=l("van-form"),T=l("van-action-bar-button"),j=l("van-action-bar"),A=l("van-popup"),E=l("van-button");return i(),u("div",me,[o(R,{title:w.value},null,8,["title"]),w.value==="选择患者"?(i(),u("div",fe,Ce)):g("",!0),s("div",ke,[(i(!0),u(Q,null,W(c.value,e=>(i(),u("div",{class:ee(["patient-item",{active:e.id==r.value}]),key:e.id,onClick:H=>D(e)},[s("div",ye,[s("span",we,C(e.name),1),s("span",Ve,C(e.idCard.replace(/^(.{6}).+(.{4})$/,"$1********$2")),1),s("span",null,C(e.genderValue),1),s("span",null,C(e.age)+"岁",1)]),s("div",{class:"icon",onClick:ae(H=>F(e),["stop"])},[o(p,{name:"edit"})],8,Pe),e.defaultFlag==1?(i(),u("div",xe,"默认")):g("",!0)],10,be))),128)),((I=c.value)==null?void 0:I.length)<6?(i(),u("div",{key:0,class:"patient-add",onClick:t[0]||(t[0]=e=>F())},[o(m,{name:"user-add"}),Fe])):g("",!0),Be]),o(A,{show:d.value,"onUpdate:show":t[5]||(t[5]=e=>d.value=e),position:"right",style:{width:"100%",height:"100%"}},{default:_(()=>[s("div",null,[o(R,{title:a.value.id?"编辑患者":"添加患者","right-text":"保存",back:()=>d.value=!1,onClickRight:U},null,8,["title","back"]),o(M,{autocomplete:"off",ref_key:"form",ref:x},{default:_(()=>[o(v,{label:"真实姓名",placeholder:"请输入真实姓名",modelValue:a.value.name,"onUpdate:modelValue":t[1]||(t[1]=e=>a.value.name=e),rules:$(ce)},null,8,["modelValue","rules"]),o(v,{label:"身份证号",placeholder:"请输入身份证号",modelValue:a.value.idCard,"onUpdate:modelValue":t[2]||(t[2]=e=>a.value.idCard=e),rules:$(re)},null,8,["modelValue","rules"]),o(v,{label:"性别",class:"pb4"},{input:_(()=>[o(de,{options:L,modelValue:a.value.gender,"onUpdate:modelValue":t[3]||(t[3]=e=>a.value.gender=e)},null,8,["modelValue"])]),_:1}),o(v,{label:"默认就诊人"},{input:_(()=>[o(V,{"icon-size":18,round:"",modelValue:B.value,"onUpdate:modelValue":t[4]||(t[4]=e=>B.value=e)},null,8,["modelValue"])]),_:1})]),_:1},512),a.value.id?(i(),X(j,{key:0},{default:_(()=>[o(T,{text:"删除",onClick:q})]),_:1})):g("",!0)])]),_:1},8,["show"]),w.value==="选择患者"?(i(),u("div",Ie,[o(E,{type:"primary",round:"",block:"",onClick:z},{default:_(()=>[Y("下一步")]),_:1})])):g("",!0)])}}});const Me=ne(Se,[["__scopeId","data-v-1d2edcc7"]]);export{Me as default};
